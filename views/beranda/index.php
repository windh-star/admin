<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
 <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" /> -->
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

<style>


element.style {
}
.row {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    margin-right: -12px;
    margin-left: -12px;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}


<!-- style col md 3 -->
element.style {
}
@media (min-width: 768px)
.col-md-4 {
    -webkit-box-flex: 0;
    -ms-flex: 0 0 50%;
    flex: 0 0 50%;
    max-width: 50%;
}

<!-- style card box -->
element.style {
}
.card-box {
    background-color: #fff;
    padding: 1.25rem;
    -webkit-box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    margin-bottom: 24px;
    border-radius: .25rem;
}
.card, .card-box {
    margin-bottom: 24px;
    -webkit-box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}

<!-- style avatar -->
element.style {
}
.avatar-md {
    height: 5rem;
    width: 5rem;
}
.mr-2, .mx-2 {
    margin-right: .5rem!important;
}
.rounded-circle {
    border-radius: 50%!important;
}
.bg-info {
    background-color: #29b6f6!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}

<!-- style span target -->
.float-right {
    float:s right!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
.text-uppercase {
    text-transform: uppercase!important;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin: 10px 0;
    font-family: Roboto,sans-serif;
    color: #343a40;
}
.h6, h6 {
    font-size: .9rem;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-weight: 500;
    line-height: 1.2;
}
user agent stylesheet
h6 {
    font-size: 0.67em;
    font-weight: bold;
}

<!-- style icon  -->
element.style {
}
.avatar-title {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    color: #fff;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: 100%;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    width: 100%;
}
.font-32 {
    font-size: 26px!important;
}
.text-white {
    color: #fff!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
i {
    font-style: italic;
}

<!-- style icon avatar -->
element.style {
}
.avatar-md {
    height: 5rem;
    width: 5rem;
}
.mr-2, .mx-2 {
    margin-right: .5rem!important;
}
.rounded-circle {
    border-radius: 50%!important;
}
.bg-info {
    background-color: #29b6f6!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}

<!-- style icon focus -->
.ion-logo-usd:before {
    content: "ïŠ±";
}

<!-- style text uppercase -->
element.style {
}
.text-uppercase {
    text-transform: uppercase!important;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin: 10px 0;
    font-family: Roboto,sans-serif;
    color: #343a40;
}
.h6, h6 {
    font-size: .9rem;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-weight: 500;
    line-height: 1.2;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
    margin-bottom: .5rem;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
h6 {
    display: block;
    font-size: 0.67em;
    margin-block-start: 2.33em;
    margin-block-end: 2.33em;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    font-weight: bold;
}

<!--style avatar title -->
element.style {
}
.avatar-title {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    color: #fff;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: 100%;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    width: 100%;
}
.font-32 {
    font-size: 32px!important;
}
.text-white {
    color: #fff!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
i {
    font-style: italic;
}

<!--style media -->
element.style {
}
.align-self-center {
    -ms-flex-item-align: center!important;
    align-self: center!important;
}
.media-body {
    -webkit-box-flex: 1;
    -ms-flex: 1;
    flex: 1;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}

<!-- style span -->
element.style {
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
.font-20 {
    font-size: 20px!important;
}
.font-weight-bold {
    font-weight: 600!important;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin: 10px 0;
    font-family: Roboto,sans-serif;
    color: #343a40;
}
.h4, h4 {
    font-size: 1.35rem;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-weight: 500;
    line-height: 1.2;
}
user agent stylesheet
h4 {
    font-weight: bold;
}
.text-right {
    text-align: right!important;
}

<!-- style media -->
element.style {
}
.media {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: start;
    -ms-flex-align: start;
    align-items: flex-start;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}


</style>


<div class="content-page">
    <!-- Start content -->
    <div class="content">
        <div class="container">
            <?php $this->load->view('layout/breadcrumb') ?>

                 
    <div class="row">
        <div class="col-md-12"> 
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title" style= "width: 100%;">FILTER</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Tahun</label>
                            <div class="form-group">
                                <input type="text" id="pilih-tahun" name="tahun" class="form-control" placeholder="Input Tahun">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Wilayah</label>
                            <div class="form-group">
                                <select class="select2-wilayah required" style="width: 100%;" id="wilayah">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card-box">
                    <div class="media">
                        <div class="avatar-md bg-info rounded-circle mr-2">
                            <i class="ion-logo-usd avatar-title font-32 text-white"></i>
                        </div>
                        <div class="media-body align-self-center">
                            <div class="text-right">
                                <h4 id="estimator" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                <p class="mb-0 mt-1 text-truncate">Total Estimator</p>
                            </div>
                        </div>
                    </div>    
                    <div class="mt-4">
                        <h6 class="text-uppercase"> <span class="float-right"></span></h6>
                        <div class="progress progress-sm m-0">
                            <div class="progress-bar bg-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                <span class="sr-only"></span>
                            </div>
                        </div>
                    </div>          
                </div>
            </div>
                        
            <div class="col-md-4">
                    <div class="card-box">
                        <div class="media">
                            <div class="avatar-md bg-purple rounded-circle">
                                <i class="ion-md-cart avatar-title font-32 text-white"></i>
                            </div>
                            <div class="media-body align-self-center">
                                <div class="text-right">
                                    <h4 id="proyek" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                    <p class="mb-0 mt-1 text-truncate">Total Proyek</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <h6 class="text-uppercase"> <span class="float-right"></span></h6>
                            <div class="progress progress-sm m-0">
                                <div class="progress-bar bg-purple" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                    <span class="sr-only"></span>
                                </div>
                            </div>
                        </div>  
                    </div>
            </div>

            <div class="col-md-4">
                    <div class="card-box">
                        <div class="media">
                            <div class="avatar-md bg-success rounded-circle">
                                <i class="ion-md-contacts avatar-title font-32 text-white"></i>
                            </div>
                            <div class="media-body align-self-center">
                                <div class="text-right">
                                    <h4 id="suplier" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                    <p class="mb-0 mt-1 text-truncate">Total Suplier</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <h6 class="text-uppercase"> <span class="float-right"></span></h6>
                            <div class="progress progress-sm m-0">
                                <div class="progress-bar bg-success " role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                    <span class="sr-only"></span>
                                </div>
                            </div>
                        </div>
                    </div>  
            </div>
        </div>
  


<div>
<div class="container">
  
  <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-9">
                        <h3 class="panel-title">Infografik Proyek</h3>
                    </div>
                    <div class="col-md-3">
                        <select name="year" id="year" class="form-control">
                            <option value="">Pilih Tahun</option>
                        <?php
                        foreach($year_list->result_array() as $row)
                        {
                            echo '<option value="'.$row["year"].'">'.$row["year"].'</option>';
                        }
                        ?>
                        </select>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div id="chart_area" style="width: 1000px; height: 620px;"></div>
            </div>
  </div>
</div>
</div>

<div>
<div class="container">
 
  <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-9">
                        <h3 class="panel-title">Infografik Estimator</h3>
                    </div>
                    <div class="col-md-3">
                        <select name="year_estimator" id="year_estimator" class="form-control">
                            <option value="">Pilih Tahun</option>
                        <?php
                        foreach($year_list->result_array() as $row)
                        {
                            echo '<option value="'.$row["year"].'">'.$row["year"].'</option>';
                        }
                        ?>
                        </select>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div id="chart_area_estimator" style="width: 1000px; height: 620px;"></div>
            </div>
  </div>
</div>
</div>

<div>
<div class="container">

  <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-9">
                        <h3 class="panel-title">Infografik Suplier</h3>
                    </div>
                    <div class="col-md-3">
                        <select name="year_suplier" id="year_suplier" class="form-control">
                            <option value="">Pilih Tahun</option>
                        <?php
                        foreach($year_list->result_array() as $row)
                        {
                            echo '<option value="'.$row["year"].'">'.$row["year"].'</option>';
                        }
                        ?>
                        </select>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div id="chart_area_suplier" style="width: 1000px; height: 620px;"></div>
            </div>
  </div>
</div>
</div>

     </div>
</div>
</div>

</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

google.charts.load('current', {packages:['corechart', 'bar']});
google.charts.setOnLoadCallback();

function load_monthwise_data(year, title)
{
    var temp_title = title + ' ' + year;
    $.ajax({
        url:"<?php echo base_url(); ?>api/fetchDataProyek",
        method:"POST",
        data:{year:year},
        dataType:"JSON",
        success:function(data)
        {
            drawMonthwiseChart(data, temp_title);
        }
    })
}

function drawMonthwiseChart(chart_data, chart_main_title)
{
    var jsonData = chart_data;
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Month');
    data.addColumn('number', 'total');

    $.each(jsonData, function(i, jsonData){
        var month = jsonData.month;
        var total = parseFloat($.trim(jsonData.total));
        data.addRows([[month, total]]);
    });

    var options = {
        title:chart_main_title,
        hAxis: {
            title: "Months"
        },
        vAxis: {
            title: 'Total'
        },
        chartArea:{width:'80%',height:'85%'}
    }

    var chart = new google.visualization.ColumnChart(document.getElementById('chart_area'));

    chart.draw(data, options);
}

function load_monthwise_data_estimator(year, title)
{
    var temp_title = title + ' ' + year;
    $.ajax({
        url:"<?php echo base_url(); ?>api/fetchDataEstimator",
        method:"POST",
        data:{year:year},
        dataType:"JSON",
        success:function(data)
        {
            drawMonthwiseChartEstimator(data, temp_title);
        }
    })
}

function drawMonthwiseChartEstimator(chart_data, chart_main_title)
{
    var jsonData = chart_data;
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Month');
    data.addColumn('number', 'total');

    $.each(jsonData, function(i, jsonData){
        var month = jsonData.month;
        var total = parseFloat($.trim(jsonData.total));
        data.addRows([[month, total]]);
    });

    var options = {
        title:chart_main_title,
        hAxis: {
            title: "Months"
        },
        vAxis: {
            title: 'Total'
        },
        chartArea:{width:'80%',height:'85%'}
    }

    var chart = new google.visualization.ColumnChart(document.getElementById('chart_area_estimator'));

    chart.draw(data, options);
}

function load_monthwise_data_suplier(year, title)
{
    var temp_title = title + ' ' + year;
    $.ajax({
        url:"<?php echo base_url(); ?>api/fetchDataSuplier",
        method:"POST",
        data:{year:year},
        dataType:"JSON",
        success:function(data)
        {
            drawMonthwiseChartSuplier(data, temp_title);
        }
    })
}

function drawMonthwiseChartSuplier(chart_data, chart_main_title)
{
    var jsonData = chart_data;
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Month');
    data.addColumn('number', 'total');

    $.each(jsonData, function(i, jsonData){
        var month = jsonData.month;
        var total = parseFloat($.trim(jsonData.total));
        data.addRows([[month, total]]);
    });

    var options = {
        title:chart_main_title,
        hAxis: {
            title: "Months"
        },
        vAxis: {
            title: 'Total'
        },
        chartArea:{width:'80%',height:'85%'}
    }

    var chart = new google.visualization.ColumnChart(document.getElementById('chart_area_suplier'));

    chart.draw(data, options);
}


///card estimator
function totalEstimator(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalEstimator",
        dataType: "JSON",
        success: function(data){
            $('#estimator').html(data.total);
        }
    });
}

//card proyek
function totalProyek(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalProyek",
        dataType: "JSON",
        success: function(data){
            console.log(data.total);
            $('#proyek').html(data.total);
        }
    });
}

//card suplier
function totalSuplier(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalSuplier",
        dataType: "JSON",
        success: function(data){
            $('#suplier').html(data.total);
        }
    });
}

</script>

<script>
    
$(document).ready(function(){
    totalEstimator();
    totalProyek();
    totalSuplier();


    $('#year').change(function(){
        var year = $(this).val();
        if(year != '')
        {
            load_monthwise_data(year, 'Month Wise Total Data For');
        }
    });

    $('#year_estimator').change(function(){
        var year = $(this).val();
        if(year != '')
        {
            load_monthwise_data_estimator(year, 'Month Wise Total Data For');
        }
    });

    $('#year_suplier').change(function(){
        var year = $(this).val();
        if(year != '')
        {
            load_monthwise_data_suplier(year, 'Month Wise Total Data For');
        }
    });

    
    function formatData (data) {
          if (!data.id) { return data.text; }
          if (data.kategori != "2") {
            return "<b>"+data.text+"</b>";
          } else {
            return "<span style='padding-left:20px'>"+data.text+"</span>";
          }
    }

    //select wilayah
    $(".select2-wilayah").select2({
          theme: "bootstrap",
          placeholder: "Pilih Wilayah",
          allowClear: true,
          tags: true,
          "language": {
            "noResults": function() {
               return "<center><img src='<?php echo base_url() ?>assets/not-found.svg' width='30' /><br><strong>Tidak ada hasil ditemukan</strong></center>";
            },
            searching: function () {
               return "<center><img src='<?php echo base_url() ?>assets/searching.gif' width='30' /><br>Mencari hasil...</center>";
            },
            loadingMore: function () {
               return "<center><img src='<?php echo base_url() ?>assets/ajax-loader.svg' width='30'/></center>";
            }
          },
          escapeMarkup: function (markup) {
               return markup;
          },
          ajax: {
            url: "<?php echo base_url('api/getListWilayah') ?>",
            dataType: 'json',
            delay: 250,
            data: function (params) {
              return {
                q: params.term,
                page_limit: 10,
                page: params.page
              };
            },
            processResults: function (data, params) {
              params.page = params.page || 1;
    
              return {
                results: data.results,
                pagination: {
                  more: (params.page * 10) < data.total_count
                }
              };
            },
            cache: true
          },
          templateResult: formatData
      });

      $('#wilayah').on('change', function() {
        reloadData();
      });
});



</script>

