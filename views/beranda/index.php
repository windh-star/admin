<style>

.row {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    margin-right: -12px;
    margin-left: -12px;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
@media (min-width: 1200px)
.col-xl-3 {
    -webkit-box-flex: 0;
    -ms-flex: 0 0 25%;
    flex: 0 0 25%;
    max-width: 25%;
}
@media (min-width: 768px)
.col-md-6 {
    -webkit-box-flex: 0;
    -ms-flex: 0 0 50%;
    flex: 0 0 50%;
    max-width: 50%;
}
.col, .col-1, .col-10, .col-11, .col-12, .col-2, .col-3, .col-4, .col-5, .col-6, .col-7, .col-8, .col-9, .col-auto, .col-lg, .col-lg-1, .col-lg-10, .col-lg-11, .col-lg-12, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-auto, .col-md, .col-md-1, .col-md-10, .col-md-11, .col-md-12, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-auto, .col-sm, .col-sm-1, .col-sm-10, .col-sm-11, .col-sm-12, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-auto, .col-xl, .col-xl-1, .col-xl-10, .col-xl-11, .col-xl-12, .col-xl-2, .col-xl-3, .col-xl-4, .col-xl-5, .col-xl-6, .col-xl-7, .col-xl-8, .col-xl-9, .col-xl-auto {
    position: relative;
    width: 100%;
    padding-right: 12px;
    padding-left: 12px;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.card-box {
    background-color: #fff;
    padding: 1.25rem;
    -webkit-box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    margin-bottom: 24px;
    border-radius: .25rem;
}
.card, .card-box {
    margin-bottom: 24px;
    -webkit-box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
    box-shadow: 0 1px 2px 0 rgba(33,37,41,.1);
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.media {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: start;
    -ms-flex-align: start;
    align-items: flex-start;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.avatar-md {
    height: 3.5rem;
    width: 3.5rem;
}
.mr-2, .mx-2 {
    margin-right: .5rem!important;
}
.rounded-circle {
    border-radius: 50%!important;
}
.bg-info {
    background-color: #29b6f6!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.avatar-title {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    color: #fff;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: 100%;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    width: 100%;
}
.font-26 {
    font-size: 26px!important;
}
.text-white {
    color: #fff!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
i {
    font-style: italic;
}
.align-self-center {
    -ms-flex-item-align: center!important;
    align-self: center!important;
}
.media-body {
    -webkit-box-flex: 1;
    -ms-flex: 1;
    flex: 1;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.mt-4, .my-4 {
    margin-top: 1.5rem!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.text-uppercase {
    text-transform: uppercase!important;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin: 10px 0;
    font-family: Roboto,sans-serif;
    color: #343a40;
}
.h6, h6 {
    font-size: .9rem;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-weight: 500;
    line-height: 1.2;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
    margin-bottom: .5rem;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
h6 {
    display: block;
    font-size: 0.67em;
    margin-block-start: 2.33em;
    margin-block-end: 2.33em;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    font-weight: bold;
}
.float-right {
    float: right!important;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
.text-uppercase {
    text-transform: uppercase!important;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin: 10px 0;
    font-family: Roboto,sans-serif;
    color: #343a40;
}
.h6, h6 {
    font-size: .9rem;
}
.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-weight: 500;
    line-height: 1.2;
}
user agent stylesheet
h6 {
    font-size: 0.67em;
    font-weight: bold;
}
.progress-sm {
    height: 5px;
}
.progress {
    -webkit-box-shadow: none;
    box-shadow: none;
    margin-bottom: 18px;
    overflow: hidden;
    height: .7rem;
}
.progress-sm {
    height: 5px;
}
.m-0 {
    margin: 0!important;
}
.progress {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: .75rem;
    overflow: hidden;
    font-size: .675rem;
    background-color: #f5f5f5;
    border-radius: .2rem;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
element.style {
    width: 60%;
}
.bg-info {
    background-color: #29b6f6!important;
}
.progress-bar {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -ms-flex-direction: column;
    flex-direction: column;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    overflow: hidden;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    background-color: #317eeb;
    -webkit-transition: width .6s ease;
    transition: width .6s ease;
}
*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}
.progress {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: .75rem;
    overflow: hidden;
    font-size: .675rem;
    background-color: #f5f5f5;
    border-radius: .2rem;
}
.text-right {
    text-align: right!important;
}

*, ::after, ::before {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
user agent stylesheet
div {
    display: block;
}

</style>

<div class="content-page">
    <!-- Start content -->
    <div class="content">
        <div class="container">
            <?php $this->load->view('layout/breadcrumb') ?>

    
    <!-- Filtering -->

    <div class="row">
        <div class="col-md-12"> 
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title" style= "width: 100%;">FILTERING</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Tahun</label>
                            <div class="form-group">
                                <input type="text" id="pilih-tahun" name="tahun" class="form-control" placeholder="Input Tahun">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Wilayah</label>
                            <div class="form-group">
                                <select class="select2-wilayah required" style="width: 100%;" id="wilayah">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Card Moltran -->

        <div class="row">
            <div class="col-md-3">
                <div class="card-box">
                    <div class="media">
                        <div class="avatar-md bg-info rounded-circle mr-2">
                            <i class="ion-logo-usd avatar-title font-26 text-white"></i>
                        </div>
                        <div class="media-body align-self-center">
                            <div class="text-right">
                                <h4 id="estimator" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                <p class="mb-0 mt-1 text-truncate">Total Estimator</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                <div class="col-md-3">
                    <div class="card-box">
                        <div class="media">
                            <div class="avatar-md bg-purple rounded-circle">
                                <i class="ion-md-cart avatar-title font-26 text-white"></i>
                            </div>
                            <div class="media-body align-self-center">
                                <div class="text-right">
                                    <h4 id="proyek" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                    <p class="mb-0 mt-1 text-truncate">Total Proyek</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card-box">
                        <div class="media">
                            <div class="avatar-md bg-purple rounded-circle">
                                <i class="ion-md-cart avatar-title font-26 text-white"></i>
                            </div>
                            <div class="media-body align-self-center">
                                <div class="text-right">
                                    <h4 id="suplier" class="font-20 my-0 font-weight-bold"><span data-plugin="counterup">-</span></h4>
                                    <p class="mb-0 mt-1 text-truncate">Total Suplier</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

<html>
<head>
	<script type="text/javascript" src="assets/chartjs/chartjs/Chart.js"></script>
</head>
<body>
	<style type="text/css">
		body{
			font-family: roboto;
		}
	</style>
 
	<h4> Grafik Perkembangan Jumlah Proyek </h4>
	<div style="width: 500px;height: 500px">
		<canvas id="myChart"></canvas>
	</div>
 
 	<script>
		var ctx = document.getElementById("myChart").getContext('2d');
		var myChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"],
				datasets: [{
					// label: '# of Votes',
					data: [12, 19, 3, 23, 2, 3],
					backgroundColor: [
					'rgba(255, 99, 132, 0.2)',
					'rgba(54, 162, 235, 0.2)',
					'rgba(255, 206, 86, 0.2)',
					'rgba(75, 192, 192, 0.2)',
					'rgba(153, 102, 255, 0.2)',
					'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
					'rgba(54, 162, 235, 0.2)',
					'rgba(255, 206, 86, 0.2)',
					'rgba(75, 192, 192, 0.2)',
					'rgba(153, 102, 255, 0.2)',
					'rgba(255, 159, 64, 0.2)'
					],
					borderColor: [
					'rgba(255,99,132,1)',
					'rgba(54, 162, 235, 1)',
					'rgba(255, 206, 86, 1)',
					'rgba(75, 192, 192, 1)',
					'rgba(153, 102, 255, 1)',
					'rgba(255, 159, 64, 1)',
                    'rgba(255,99,132,1)',
					'rgba(54, 162, 235, 1)',
					'rgba(255, 206, 86, 1)',
					'rgba(75, 192, 192, 1)',
					'rgba(153, 102, 255, 1)',
					'rgba(255, 159, 64, 1)'
					],
					borderWidth: 2
				}]
			},
			options: {
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero:true
						}
					}]
				}
			}
		});
	</script>
</body>
</html>

        </div>
    </div>
</div>

<script type="text/javascript">
var id_pengguna = Cookies.get('id_pengguna');

///reload tabel 
function reloadData(){
    table.ajax.reload();
}
///card estimator
function totalEstimator(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalEstimator",
        dataType: "JSON",
        success: function(data){
            $('#estimator').html(data.total);
        }
    });
}

//card proyek
function totalProyek(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalProyek",
        dataType: "JSON",
        success: function(data){
            console.log(data.total);
            $('#proyek').html(data.total);
        }
    });
}

//card suplier
function totalSuplier(){
    $.ajax({
        url: "<?php echo base_url() ?>api/totalSuplier",
        dataType: "JSON",
        success: function(data){
            $('#suplier').html(data.total);
        }
    });
}

function TrenProyekAllTahun(){
    var d = new Date();
    var y = d.getFullYear();
    if(proyek == null || proyek == ''){
      $('#statistik-proyek-tahun').html("Statistik Produk Tahun "+y+"");
    $.ajax({
        url: "<?php echo base_url('api/trenProyekAllTahun') ?>",
        type: "POST",
        dataType: "JSON",
        success: function(data){
        var proyek = [];
        var total = [];
        for (var i in data){
            tahun.push(data[i].tahun);
            proyek.push(data[i].proyek);
            total.push(data[i].total);
            }
        if(total == 0)
        {
          $('#tren-tahun').hide();
          // $('#gambar').show();
          
        }else{
            // $('#gambar').hide();
            $('#statistik-produk-tahun').html("Statistik Produk Tahun "+y+"");
            var options = {
            series: [{
                name: "Total Proyek",
                data: total,
            }],
            chart: {
                height: 350,
                type: 'area',
            },
            dataLabels: {
                enabled: false
            },
            fill:{
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.9,
                    stops: [0, 90, 100]
                }
            },
            xaxis:{
                categories: proyek,
                type: 'category',
                tickPlacement: 'on',
                labels: {},
            }
        }
        var chart = new ApexCharts(document.querySelector('#tren-tahun'), options);
        chart.render();
                
        chart.updateSeries([{
        name: "Total Proyek",
        data: total,
        }])
            }
        }
    });
    
   }else{
      //  var pilih = produk.replace("%20", " ");
       $('#statistik-produk-tahun').html("Statistik Produk Tahunan");
       $.ajax({
           url: "<?php echo base_url('api/FilterTrenProyekPerTahun') ?>",
           type: "POST",
           dataType: "JSON",
           success: function(data){
               var tahun = [];
               var total = [];
               var proyek = [];
               for (var i in data){
                   tahun.push(data[i].tahun);
                   total.push(data[i].total);
                   proyek.push(data[i].proyek);
               }
               if(value == 0){
                   $('#statistik-produk-pertahun').html("Statistik Produk Tahunan");
                   $('#tren-tahun').hide();
                  //  $('#gambar').show();
               }else{
                // $('#gambar').hide();
                var options = {
                    chart: {
                    height: 350,
                    type: "area"
                    },
                        dataLabels: {
                        enabled: false
                    },
                    series: [
                    {
                        name: "Total Proyek",
                        data: [0, value],
                    }
                    ],
                    fill: {
                        type: "gradient",
                        gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.9,
                        stops: [0, 90, 100]
                    }
                    },
                        xaxis: {
                        categories: tahun
                    },
                    };
                    var chart = new ApexCharts(document.querySelector("#tren-tahun"), options);
                    chart.render();
                    
                    chart.updateSeries([{
                        name: "Total Proyek ",
                        data: total
                    }])
               }
           }
       });
   }
}


$(document).ready(function(){
    totalEstimator();
    totalProyek();
    totalSuplier();

    $.fn.dataTableExt.oApi.fnPagingInfo = function(oSettings){
        return {
             "iStart": oSettings._iDisplayStart,
              "iEnd": oSettings.fnDisplayEnd(),
              "iLength": oSettings._iDisplayLength,
              "iTotal": oSettings.fnRecordsTotal(),
              "iFilteredTotal": oSettings.fnRecordsDisplay(),
              "iPage": Math.ceil(oSettings._iDisplayStart / oSettings._iDisplayLength),
              "iTotalPages": Math.ceil(oSettings.fnRecordsDisplay() / oSettings._iDisplayLength)
        };
    };

    function formatData (data) {
          if (!data.id) { return data.text; }
          if (data.kategori != "2") {
            return "<b>"+data.text+"</b>";
          } else {
            return "<span style='padding-left:20px'>"+data.text+"</span>";
          }
    }

    //select wilayah
    $(".select2-wilayah").select2({
        theme: "bootstrap",
        placeholder: "Pilih Wilayah",
        allowClear: true,
        tags: true,
        "language": {
         "noResults": function(){
                return "<center><img src='<?php echo base_url() ?>assets/not-found.svg' width='30' /><br><strong>Tidak ada hasil ditemukan</strong></center>";
            },
            searching: function() {
                return "<center><img src='<?php echo base_url() ?>assets/searching.gif' width='30' /><br>Mencari hasil...</center>";
            },
            loadingMore: function() {
                return "<center><img src='<?php echo base_url() ?>assets/ajax-loader.svg' width='30'/></center>";
            }
        },
        escapeMarkup: function(markup){
            return markup;
        },
        ajax: {
            url: "<?php echo base_url('api/getListWilayah') ?>",
            dataType: 'json',
            delay: 250,
            data: function (params){
                return {
                    q:params.term,
                    page_limit: 10,
                    page: params.page
                };
            },
            processResults: function(data, params){
                params.page = params.page || 1;
                
                return {
                    results: data.results,
                    pagination: {
                        more: (params.page * 10) < data.total_count
                    }
                };
            },
            cache: true
        },
        templateResult: formatData
    });
    //end select wilayah

    //select proyek
    $(".select2-proyek").select2({
          theme: "bootstrap",
          placeholder: "Pilih Proyek",
          allowClear: true,
          "language": {
            "noResults": function() {
               return "<center><img src='<?php echo base_url() ?>assets/not-found.svg' width='30' /><br><strong>Tidak ada hasil ditemukan</strong></center>";
            },
            searching: function () {
               return "<center><img src='<?php echo base_url() ?>assets/searching.gif' width='30' /><br>Mencari hasil...</center>";
            },
            loadingMore: function () {
               return "<center><img src='<?php echo base_url() ?>assets/ajax-loader.svg' width='30'/></center>";
            }
          },
          escapeMarkup: function (markup) {
               return markup;
          },
          ajax: {
            url: "<?php echo base_url('api/getListProyek') ?>",
            dataType: 'json',
            delay: 250,
            data: function (params) {
              return {
                q: params.term,
                page_limit: 10,
                page: params.page
              };
            },
            processResults: function (data, params) {
              params.page = params.page || 1;
    
              return {
                results: data.results,
                pagination: {
                  more: (params.page * 10) < data.total_count
                }
              };
            },
            cache: true
          },
          templateResult: formatData
      });

      $('#wilayah-bahan,#namaproyek').on('change', function() {
        reloadData();
      });

    ///memanggil fungsi chart bulan
    // getGrafikTrenProdukBulan();
    ///memanggil fungsi chart tahun
    // getGrafikTrenProdukTahun();
    ///memanggil fungsi map
    // getMap();
    ///memanggil card
    // cardProduk();
    // cardProdukTerpakai();
    // cardPenggunaProyek();
    // TrenPaketProduk();
    // $('#map').hide();
    // $('.id').hide();
    var change = $('#select-produk').on('change', function(){
        // getGrafikTrenProdukBulan();
        // getGrafikTrenProdukTahun();
        // cardProduk();
        // cardProdukTerpakai();
        // cardPenggunaProyek();
        // updateMap($('#select2-select-produk-container').prop('title'));
    });
    
});
</script>